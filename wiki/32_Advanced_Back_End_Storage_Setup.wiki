#summary DRBD, software RAID (md), LVM2, and CLI RAID tool information.

=== Distributed Replicated Block Device (DRBD) ===
TODO
DRBD resources (starting/stopping) are typically handled by the cluster stack (Pacemaker + Corosync), so there is no init/rc script for DRBD included with ESOS. If you would like to use DRBD without the cluster stack, you can use the `/etc/pre-scst_xtra_conf` file to setup/configure the DRBD resources on boot.

<br>

=== Linux Software RAID (md) ===
TODO

<br>

=== Logical Volume Manager (LVM2) ===
TODO

<br>

=== Local RAID Controller: LSI MegaRAID (CLI) ===
The LSI Logic "MegaCLI" utility is an install option with ESOS (during the installation script). The utility allows you to create/delete/modify volumes (logical drives) on your MegaRAID controller. Below are a few examples of using the MegaCLI tool (MegaCli64 for us). A nice handy cheat sheet is located [http://tools.rapidsoft.de/perc/perc-cheat-sheet.html here]. Or for a very in-depth document, consult the user guide available on LSI Logic's web site.

Get adapter information for the first MegaRAID adapter (0):
{{{
MegaCli64 -AdpAllInfo -a0
}}}

A list of all the adapter's physical drives:
{{{
MegaCli64 -PDList -a0
}}}

All of the logical drives for the adapter:
{{{
MegaCli64 -LDInfo -Lall -a0
}}}

Delete logical drive 0:
{{{
MegaCli64 -CfgLdDel -L0 -a0
}}}

Create a new RAID5 logical drive, with three physical disks, adaptive read-ahead (ADRA) and write cache enabled (WB):
{{{
MegaCli64 -CfgLDAdd -R5[8:0,8:1,8:2] WB ADRA -a0
}}}

Create a new RAID0 logical drive, with two physical disks, no read-ahead (NORA) and write cache disabled (WT):
{{{
MegaCli64 -CfgLDAdd -R0[8:0,8:1] WT NORA -a0
}}}

After you have created your new volume(s) you will need to find and record the SCSI device node (eg, /dev/sdz). You can easily find this using `lsscsi` or checking `dmesg`.

<br>

=== Local RAID Controller: Adaptec AACRAID (CLI) ===
The arcconf utility is also an install option with ESOS for configuring Adaptec RAID controllers from inside the OS. This tool should work with most/all Adaptec SATA/SAS RAID controllers.

See all controller/drive/volume information for controller # 1:
{{{
arcconf GETCONFIG 1
}}}

Delete logical device (volume) 1 on controller 1:
{{{
arcconf DELETE 1 LOGICALDRIVE 1
}}}

Make a new RAID5 volume on controller 1 using three disks (channel 0, device numbers 2, 3, 4) with read cache enabled and write cache enabled:
{{{
arcconf CREATE 1 LOGICALDRIVE Rcache RON Wcache WB MAX 5 0 2 0 3 0 4
}}}

Make a new RAID0 volume on controller 1 using two disks (channel 0, device numbers 2, 3) with read cache disabled and write cache disabled:
{{{
arcconf CREATE 1 LOGICALDRIVE Rcache ROFF Wcache WT MAX 0 0 2 0 3
}}}

Once you've created a new volume on your Adaptec RAID controller, grab the SCSI device node (`lsscsi` works well) and continue with one of the target configuration sections below.

<br>

=== Local RAID Controller: Other ===
Other RAID controllers are supported, however, not all of them necessarily have a CLI tool for configuring volumes, adapter settings, etc. from inside of ESOS. See the [03_Supported_Hardware] wiki page for a current list of supported controllers and possible corresponding CLI utilities.

You can still use these other controllers with ESOS, you will just need to configure your volumes / logical drives "outside" of ESOS -- via the BIOS. Or seek the documentation for using the CLI tools on your own.

If you find that your favorite "enterprise class" RAID controller is not supported by ESOS, please let us know on the esos-users Google Group. It would also be helpful to know if there are any CLI management tools that can be used to configure these controllers from inside the OS.

<br>

=== Virtual Tape Library (VTL) ===
ESOS includes the mhVTL software (virtual tape library); this, combined with data de-duplication makes an excellent traditional tape library (eg, DLT, LTO, etc.) replacement. You can use this virtual tape library on your Storage Area Network (SAN -> Fibre Channel, iSCSI, etc.). The mhVTL service is disabled by default -- to enable it, simply edit the /etc/rc.conf file and set `rc.mhvtl_enable` to "YES".

The data storage location (mount point in the file system) is hard coded in the software (/mnt/mhvtl). You'll need to create a new back-end storage device and file system then mount it on `/mnt/mhvtl` and update the fstab file.

If you are going to use lessfs for de-duplication as the mhVTL storage backing, you will want to use a separate persistent storage device (RAID volume) for the lessfs configuration data and database. You will then use the `/mnt/mhvtl` location for a separate underlying back-end storage file system, and then use the same location as the lessfs mount point. The key point here is that you need two separate persistent file systems for this setup with lessfs and mhVTL: One for the lessfs data, and one the mhVTL data.


<br>

=== Inline Data De-duplication ===
De-duplication in ESOS is handled by lessfs, a virtual file system for FUSE. The lessfs file system is mounted on top of a "normal" (eg, ext3, xfs, etc.) and provides compression and encryption. You can then use this lessfs file system as your back-end storage for mhVTL or SCST FILEIO devices, seamlessly providing de-duplication.

A separate, unique lessfs configuration file is needed for each lessfs file system. One configuration file can not handle multiple lessfs instances. A database (local files, Berkeley DB) is used for each lessfs file system, which is configured using the lessfs configuration file.

The location for the lessfs database files and configuration file needs to be a persistent attached storage device on ESOS (eg, logical drive on local RAID controller). *Do not use any locations on the esos_root file system (/) for storing lessfs configuration files, or databases!*

A typical setup for lessfs looks like this:
  * Create a new back-end storage file system using the TUI. Example mount point: /mnt/vdisks/test_fs_1
  * You would then create your lessfs configuration file here: /mnt/vdisks/test_fs_1/lessfs.cfg
  * Create these three directories: /mnt/vdisks/test_fs_1/mta /mnt/vdisks/test_fs_1/dta /mnt/vdisks/test_fs_1/data

Here is an example lessfs configuration file (/mnt/vdisks/test_fs_1/lessfs.cfg):
{{{
DEBUG=5
HASHNAME=MHASH_TIGER192
HASHLEN=24
BLOCKDATA_IO_TYPE=file_io
BLOCKDATA_PATH=/mnt/vdisks/test_fs_1/dta/blockdata.dta
META_PATH=/mnt/vdisks/test_fs_1/mta
META_BS=1048576
CACHESIZE=512
COMMIT_INTERVAL=10
LISTEN_IP=127.0.0.1
LISTEN_PORT=100
MAX_THREADS=16
DYNAMIC_DEFRAGMENTATION=on
COREDUMPSIZE=2560000000
SYNC_RELAX=0
BACKGROUND_DELETE=on
ENCRYPT_DATA=off
ENCRYPT_META=off
ENABLE_TRANSACTIONS=on
BLKSIZE=131072
COMPRESSION=snappy
}}}

Create the new lessfs file system:
{{{
mklessfs -f -c /mnt/vdisks/test_fs_1/lessfs.cfg
}}}

Now add this line to your /etc/fstab file; be sure this line is _after_ your normal, back-end file system that lessfs sits on top of:
{{{
lessfs#/mnt/vdisks/test_fs_1/lessfs.cfg /mnt/vdisks/test_fs_1/data fuse defaults 0 0
}}}

You can now mount your lessfs file system:
{{{
mount /mnt/vdisks/test_fs_1/data
}}}

You now have a file system that supports inline data de-duplication and can be used for virtual disk files (vdisk_fileio). If you are going to use lessfs in conjunction with mhVTL, you should use a separate storage device for the lessfs configuration and metadata (database files) since the VTL path is static. See the [http://www.lessfs.com/wordpress/ lessfs] web site for additional documentation and an explanation of the configuration parameters.

<br>

=== File Systems & Virtual Disk Files ===
After you have setup/configured your advanced back-end storage, it will still appear as a block device, just as described in the basic back-storage wiki document.

With this logical block device, you can now create a file system on it and create virtual disk files, if desired. Follow the same steps as described in the [31_Basic_Back_End_Storage_Setup] document for making file systems and adding virtual disk files, but with the advanced back-storage, you'll select your DRBD block device (eg, /dev/drbd0) or whatever advanced block device you configured.

<br>

=== Next Steps ===
You should now continue on to the [41_Hosts_and_Initiators] wiki page which will guide you through configuring SCST security groups.